#!/usr/bin/env bash
# Pre-commit hook: fast lint checks (Rust fmt/clippy + FE eslint/tsc).
# Bypass: SKIP_HOOKS=1 git commit ... (or --no-verify)
set -euo pipefail

if [ "${SKIP_HOOKS:-0}" = "1" ]; then
  echo "pre-commit: skipped (SKIP_HOOKS=1)"
  exit 0
fi

echo "=== pre-commit: linting ==="

# --- Rust ---
if command -v cargo &>/dev/null; then
  echo "  cargo fmt --check..."
  cargo fmt --check

  echo "  cargo clippy..."
  cargo clippy -- -D warnings
else
  echo "  cargo not found, skipping Rust lints"
fi

# --- Frontend ---
if [ -f ui_web/package.json ]; then
  echo "  eslint..."
  npm --prefix ui_web run lint

  echo "  tsc..."
  (cd ui_web && npx tsc -b --noEmit)
else
  echo "  ui_web/package.json not found, skipping FE lints"
fi

echo "=== pre-commit: all lints passed ==="
